/*
 * SkewT v1.0.0
 * 2016 David Félix - dfelix@live.com.pt
 * Dependency:
 * d3.v3.min.js from https://d3js.org/
 */
var SkewT=function(a){var b=document.createElement("div");b.id="skewtbox",a.appendChild(b);var c=[30,40,20,35],d=700-c[1]-c[3],e=700-c[0]-c[2],f=Math.PI/180,g=Math.tan(55*f),h=1050,i=100,j=[1e3,850,700,500,300,200,100],k=[950,900,800,750,650,600,550,450,400,350,250,150],l=25,m=d3.scale.linear().range([0,d]).domain([-45,50]),n=d3.scale.log().range([0,e]).domain([i,h]),q=(d3.scale.linear().range([0,300]).domain([0,150]),d3.scale.linear(),d3.svg.axis().scale(m).tickSize(0,0).ticks(10).orient("bottom")),r=d3.svg.axis().scale(n).tickSize(0,0).tickValues(j).tickFormat(d3.format(".0d")).orient("left"),s=d3.svg.axis().scale(n).tickSize(5,0).tickValues(k).orient("right"),t=d3.svg.line().interpolate("linear").x(function(a,b){return m(a.temp)+(n(h)-n(a.press))/g}).y(function(a,b){return n(a.press)}),u=d3.svg.line().interpolate("linear").x(function(a,b){return m(a.dwpt)+(n(h)-n(a.press))/g}).y(function(a,b){return n(a.press)}),v=d3.bisector(function(a){return a.press}).left,w=d3.select("div#skewtbox").append("svg").attr("width",d+c[1]+c[3]).attr("height",e+c[0]+c[2]).append("g").attr("transform","translate("+c[3]+","+c[0]+")"),x=w.append("g").attr("class","skewt"),y=w.append("g").attr("class","windbarb"),z=function(){var a=d3.select("div#skewtbox svg g").append("g").attr("class","skewtbg"),b=d3.svg.line().interpolate("linear").x(function(a,b){return m((273.15+a)/Math.pow(1e3/c[b],.286)-273.15)+(n(h)-n(c[b]))/g}).y(function(a,b){return n(c[b])});a.append("clipPath").attr("id","clipper").append("rect").attr("x",0).attr("y",0).attr("width",d).attr("height",e),a.selectAll("templine").data(d3.range(-100,45,10)).enter().append("line").attr("x1",function(a){return m(a)-.5+(n(h)-n(100))/g}).attr("x2",function(a){return m(a)-.5}).attr("y1",0).attr("y2",e).attr("class",function(a){return 0==a?"tempzero":"gridline"}).attr("clip-path","url(#clipper)"),a.selectAll("pressureline").data(j).enter().append("line").attr("x1",0).attr("x2",d).attr("y1",function(a){return n(a)}).attr("y2",function(a){return n(a)}).attr("class","gridline");for(var c=d3.range(i,h+1,10),f=d3.range(-30,240,20),k=[],l=0;l<f.length;l++){for(var o=[],p=0;p<c.length;p++)o.push(f[l]);k.push(o)}a.selectAll("dryadiabatline").data(k).enter().append("path").attr("class","gridline").attr("clip-path","url(#clipper)").attr("d",b),a.append("line").attr("x1",d-.5).attr("x2",d-.5).attr("y1",0).attr("y2",e).attr("class","gridline"),a.append("g").attr("class","x axis").attr("transform","translate(0,"+(e-.5)+")").call(q),a.append("g").attr("class","y axis").attr("transform","translate(-0.5,0)").call(r),a.append("g").attr("class","y axis ticks").attr("transform","translate(-0.5,0)").call(s)},A=function(){var a=d3.range(5,105,5),b=w.append("defs");a.forEach(function(a){var c=b.append("g").attr("id","barb"+a),d=Math.floor(a/50),e=Math.floor((a-50*d)/10),f=Math.floor((a-50*d-10*e)/5),g=l;c.append("line").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",l);for(var h=0;h<d;h++)c.append("polyline").attr("points","0,"+g+" -10,"+g+" 0,"+(g-4)).attr("class","flag"),g-=7;for(h=0;h<e;h++)c.append("line").attr("x1",0).attr("x2",-10).attr("y1",g).attr("y2",g+4),g-=3;for(h=0;h<f;h++)c.append("line").attr("x1",0).attr("x2",-5).attr("y1",g).attr("y2",g+2),g-=3})},B=function(a){var b=a.reverse(),c=x.append("g").attr("class","focus tmpc").style("display","none");c.append("circle").attr("r",4),c.append("text").attr("x",9).attr("dy",".35em");var f=x.append("g").attr("class","focus dwpc").style("display","none");f.append("circle").attr("r",4),f.append("text").attr("x",-9).attr("text-anchor","end").attr("dy",".35em");var i=x.append("g").attr("class","focus").style("display","none");i.append("text").attr("x",0).attr("text-anchor","start").attr("dy",".35em");var j=x.append("g").attr("class","focus windspeed").style("display","none");j.append("text").attr("x",0).attr("text-anchor","start").attr("dy",".35em"),w.append("rect").attr("class","overlay").attr("width",d).attr("height",e).on("mouseover",function(){c.style("display",null),f.style("display",null),i.style("display",null),j.style("display",null)}).on("mouseout",function(){c.style("display","none"),f.style("display","none"),i.style("display","none"),j.style("display","none")}).on("mousemove",function(){var a=n.invert(d3.mouse(this)[1]),d=v(b,a,1,b.length-1),e=b[d-1],k=b[d],l=a-e.press>k.press-a?k:e;c.attr("transform","translate("+(m(l.temp)+(n(h)-n(l.press))/g)+","+n(l.press)+")"),f.attr("transform","translate("+(m(l.dwpt)+(n(h)-n(l.press))/g)+","+n(l.press)+")"),i.attr("transform","translate(0,"+n(l.press)+")"),c.select("text").text(Math.round(l.temp)+"°C"),f.select("text").text(Math.round(l.dwpt)+"°C"),i.select("text").text("-- "+Math.round(l.hght)+" m"),j.attr("transform","translate(555,"+n(l.press)+")"),j.select("text").text(Math.round(10*E(l.wspd))/10+" kts")})},C=function(a){x.selectAll("path").remove();var b=a.filter(function(a){return a.temp>-1e3&&a.dwpt>-1e3}),c=[];c.push(b);x.selectAll("templines").data(c).enter().append("path").attr("class",function(a,b){return b<10?"temp member":"temp mean"}).attr("clip-path","url(#clipper)").attr("d",t),x.selectAll("tempdewlines").data(c).enter().append("path").attr("class",function(a,b){return b<10?"dwpt member":"dwpt mean"}).attr("clip-path","url(#clipper)").attr("d",u);y.selectAll("use").remove();var g=b.filter(function(a){return a.wdir>=0&&a.wspd>=0&&a.press>=i});y.selectAll("barbs").data(g).enter().append("use").attr("xlink:href",function(a){return"#barb"+5*Math.round(E(a.wspd)/5)}).attr("transform",function(a,b){return"translate("+d+","+n(a.press)+") rotate("+(a.wdir+180)+")"});B(c[0])},D=function(a){x.selectAll("path").remove(),y.selectAll("use").remove(),w.append("rect").attr("class","overlay").attr("width",d).attr("height",e).on("mouseover",function(){return!1}).on("mouseout",function(){return!1}).on("mousemove",function(){return!1})},E=function(a){return 1.943844492*a};this.drawBackground=z,this.plot=C,this.clear=D,z(),A()};